(function(){

var chars, total;
chars = "一丿ㄚ八卜七丁刁刀九力了二入人又十叉才千寸彳亍川丈凡久弓干工下口已乞口女也已三山小尸上上大土子巴比不分切尺丹仃斗弔中引反幻火方夫戶互戶父分支勾今斤公凶及欠孔六毋毛木內五牙日月牛片夭仁仍引友尤勻允心少氏仇手水太天屯王勿文爪井止中凹叭半包北必丙布本且出打旦叮叼冬氾犯付加甲甘句古瓜功玄穴兄卡巧去巧可立令令末民母目尼另奶尼奴瓦凹冉玉外扒白冇皮平乒平以以由右幼孕永用生生四仙司仕石召世市示失申丞他田台代凸禾左正正汁正主朳百冰在次自全池串住丟吊丟多帆伙灰回缶份合合交肌吉吉奸各光扛江虫另虫官合行好后血休向兇何好亥汗考企扣曲共老劣米名妄耳艾刓年仰肉安伴鬥伏扡衣如而羽弛任因印有羊戎色西死先字先存成舌兆寺成臣收守地在托吐同汙位再尖早庄米至朱竹圳扼把伯扳扮庇批兵邦抔岔杉抄吵吮坐床助沖車扯赤沉呈呆吹伸低甸肚囤宏妨防扶佛吩更戒妓技佢夾決更見芎角改估佝攻含罕孝杏希形旱坑坎忌汽岐求狂囥快困伶冷里李利卵汨妙牡免芒忘芒沒尾男弄吾忤你尿忍扭我呆別批屁步妖抑役妊沙邪私辛秀巡沈伸身辰杓芍汰但忒投豆弟佃妥杜吞完芋抓找走佔即足灶作壯折志阿亞押坳拗芭拔版孢陂畀泌表拚並秉並併枋放斧杯奔拆炒取刺刺青青泅刺松狀初治直抽炊長狀的底抵沾知的店到剁咄東花法泛返或和芳房放狐府虎附戽忽拂咈服非昏芬昏忿奉佳咖呷屆芥居拘枝肢肩狗金京糾糾供果往姑孤怙乖刮怪拐官季肯幸弦欣享河呵刻奇股屈芹近近屈矻昆空垃拉拉例兩拉來囹抹孟命明明盲妹罔歿味門林奈泥竻呢宜芮岩拈念迎臥玩阿爬怕拔拋抱泡朋披枇波泡拍抨芙肥呸夜延沿芫依於雨易油芸泳使使事性所社舍事呻昇承尚受叔刣帖定拖拓抬宕兔泧拂和往旺枉武委物爭沼姊阻宗炙招制征枕周咒長注忠疤背柏拜拜胞柄扁玻保背飛查昨柵泉前柿侵秋促剉閂持姪值值紂穿苧春重重值訂帝恬屌挏活范皇胡負赴恢飛封風洪紅俸枷洽柑狡郊界既紀急計革弇建峎枸韭軍拱拱降故冠皈限係恆厚後肺俠姣香哄巷降枵洽客訄拷祈牯茄契觔科看苦流恅陋俚流柳洛郎律茅眉勉面若耐南怒耐咬若染研虐哀按派叛炮迫便便拼品屏胚背訃盆耶頁要要怨姨疫姻音英盈幽柔柚約洋砂衫省洗星牲洩宣思信削相施屎是拾食拭甚乘待怠炭胝帣剃挑迢胎段度突毒洞挖哇歪侮屋威為畏胃炸拶奏姿津昭指致珍政斫唉俺恁盎班粄豹俾祕剝圃埔砰哺浡畚差茶差財脆牸秦草座挫衰捙恥秤陣臭除釘挺陡砧凋展倒倒追凍挨恩恩浮荒茯迴茴悔紛粉家耕哽徑校個飢記桔唊兼挾捐宮恭高晃骨訌鬼桂夏狹核效桁耗核候畜胸耗海害捍涆航起起豈氣屐缺拳虔恐庫捆栗旅荔料留烙捋浪狼朗倫馬脈埋迷眠蚊拿納哪捏挼原弱娘娛悟烏病浮紡剖破砰旁悅冤胭舀宴院倚殷浴秧氧容紗閃豺晒捎席消哨笑師梳修唆索衰桑孫送射眨閃陜舐扇捎時神書殊紓純唇泰挺特庭桃討逃套唐徒退挽烏笊砧借唧浸唚晉酒捉桌祖追浙隻紙針振症祝啞庵掩唵缽絆崩閉畢彪婊匾彬晡笨猜彩採參悽娶淬斜捷淨淺清情旋袖崇從曹造措粗捽族奢痔深逞陳唱悵處逐笪帶探頂得頂兜鳥悼眺釣得掙堆堵都堵啄涿啄崠捱掩販患貨訪符副婦斛晦婚混逢假袈教教寄崎訣堅捲眷竟救焗桷崗蛄掛國貫莖規盒啣涵陷莧梟掀現毫荷笴焊啟棄硈袪牽健強毬球康掘硈控啦涎聆勒犁理梨笠捩粒連淋羚掠略陵涼硫陸鹿累麻麥猛莽密覓莫梅脢梅問捺淰梧魚唸眼偶軟偽蚵蚵孲屙排敗票莩被被偏瓶貧瓠符烳部陪捧野掩掞寅移掖陰悠欲庸殺徙產巢細參習惜惜雪宿挲掃爽速蛇捨赦設紹紳盛船常授庶寂貪探淡探偷透第添甜停陶脫推梯袋屠推動通桶統偎晚惟紮紮斬側祭接責剪將做朘組莊執晝蛀專帳硃終眾舂許發跋跛斑悲湢筆摒貶揙摒報博發博掰傍棒發插裁殘惻策曾湊棲萋晴菁絕詞尋就菜窗程掣超朝殖趁著場敞暑隊答單登等貼貂著跌惰著短貯敦棟華畫發番飯湖富幅復揮菲惠費焚傢敢間絞階幾給幾厥街揭結間揀筋景割菅稈雇棺貴棍蛤喊閒喊喉猴稀虛喜翕翕鄉雄賀喝渴寒項堪欺期棋喫絭菣腔揪菊嵙開款喇亂晾裂量量勞絡絡亂廊買愐貿棉無帽媒惱腍鈕雅硬硬殗揉韌咢愕惡發牌棚跑琵脾備萍評焙飯椪普菩賁越菸援愉椅軼猶郵揚陽雲閏絨湧散婿犀絲絮集斯絲廂象痠酥筍順善視腎稅順替毯跈敨提痘隄替貼奠渟貸揣湯渡鈍童痛蛙椏畫換黃無渾詐測揕焦進棗著尊竣棕朝詔智診週喙著掌煮註隘暗靶搬頒飽逼痺碰補腹搽剷賊慈飼搶像揫搓滄催嗽罪媸痴雉試傳傳腸搐搥銃搭搭嗒凳蒂嫡墊碇搗跢當當零頓董矮搕煩毀煥夥慌葫毀彙會葷暈嫁鉀裌隔感粳經搞較解該解跟溝鉤禁經敬腳境僅過葛該幹寡蜆歇靴號較跤極嗋鼓禽舅勤窟誇筷跪落睞零落零嘍廉僚煉溜溜腡落酪路落碌雷媽搣微募煤墓寧腦暖煖農嫩蜈傲愚義遇惹業源暈頑奧遏愛嗀稗聘葡孵楓蜂爺葉搖搖腰煙圓猿鉛意預搤遊楊隕運雍溶煠煞鉎塞愁楔獅新想詳塑煞歲損搧詩勢溼慎聖塵傷嫦搜酬壽塾馴塌達痶墊跳稠跳殿電墊滔道奪團塘搪塗圖蛻遁僮話滑猾劃碗萬會搵違溫搵債載嘖節煎資裝照斟準滮裨鄙幣弊裱賓駁榜摻慘綻齊聚漆漸磁寢盡銓槍翠賒徹撤滯稱暢綢蜘滴滴端碫對漚罰禍腐福翡緋鳳價監構緊歌膏閣綱槓歌管趕慣閨滾銜熊豪熇福漢敲嶇旗歉輕儉遣箍跼劊裸辣摟漏厲領榴劉綠滷犖滷摝銇麼麼滿慢漫貌摸綿網摸漁疑語餌認銀誤漂漂鼻僻漂膀演遠與億誘殞榕榮熔誚需誦趖算酸蒜榫碩覡蝕煽誓蒔睡說態遞碳遞暢綯臺颱銅輓窩舞維聞熅榨摘嶄際輒截截精粽綜摺製誌賑漲種種鴉醃懊罷撥撥褒暴憑標壁編奮褒播踣踣輩撐層瘦趣膝槧請遷賤槽銼撮撞蔥衝鄭遰憔潮澄撰篆廠廚墜德適賭墩噎歐毆熰範樊緩膚糊蝴撫複輝廢慧憤憤奮鋒稽嘰嬌潔鴃趜糊稿頦廣穀蝦詹嘿鞋緪嬉賢憲學銲磕慶撬凝墾撳窮確課靠寬潰潦撈樓鋁寮撩憐蓮練輪蓮輦輪鄰樑諒瘤罶潦樂鋃魯熝論輪論碼罵賣妻墨瞇廟摩暮暮模模撓餒鬧撓噥磕熬遨毅熱撚樂餓撥潑潑盤暴標蝠篇編憑賠澎鋪撲噴蓬鋒影窯緣蝓閱蔭憂魷養樣銳潤熨壅儕巢蝨寫銷漦線駛箱熟熟嬋適審賞樞熟醇踏談彈誕踢敵締調調震導導緞衛慰瘟碾撮增漀靚漿槳獎皺遭醉蔗遮膣質徵斲樟豬鴨鴨閼壓諳翱擘縛鮑篦觱濱縛幫操擇篩霋樵錢親靜錯餐瞠遲篡擔戴澹擔燈蹀雕擋檔篤燉壓應蕃糐輻徽橄機鋸激撿檢頸激噭錦鋼龜嚇憨蕑戲險曉興興壕磡擎橋瘸磬實褲擐賴遶歷斂嶺遼遴錄龍駱擄擂瞞謀磨磨濛膩濃頷頷擬貓諺膨辦膨頻膨歕閹縈鴛燃燕縣踰頤諭穎螢應優擁融踴醒錫選簑隨擅燒膳樹輸澹曇燂檀頭蹄醍鴕擇糖獨頹褪橫噦霍遺磧濟蕉積諮錙錐戰整整磚濁擺擺臂檳殯糞趨臍謝鍬牆薔叢蹉糙賺竄簇聰蟄醜錘蟲膽點點斷斷翻翻繁獲覆豐舉遽艱簡購薑殭謹講鮭歸還轄韓謙翹舊鞠糠闊環虧櫃罅濫濫檸螻禮隸濾獵療瞭聯臨臨鍊糧瀏螺壘窿窿篾藐糜濫闌膿癌黏輾蟠避濞薄翻瞨覆縫隱營謠邀輿臆薏翼營擤瀉簫鮮繡臊縮霜雖禪蟬聲謄斷檯盪鍛盪螳鍍瀆還豁餵蕹甕齋簪輾燥糟縱糟贅總織職簸蹦爆髀鞭簸雜簽闖癡懲獸雛櫥鎚寵蹛懷壞繪繳雞繫疆闔闔騎臘壢瀝離鯉簾羅廬懵矇懶藕額藕顏鵝攀曝鵓簷醫鎖雙鬆題穩鯽醬鎮轉鏢邊寶攙鏨懺闡躁嚼辭鯧纂觸籌觸譫蹬竇顛觸鵪鬍繼鏡轎警競關鹹蠍懸獻蠔蹺蹻轎蹶爌邋籃攔鏤礫鏈巃攔蘆類麵難糯繷議嚴饒蟻孽願襛飄騙譜贏譯罌蠅藥韻籍釋蘇蟾贍識藤鶉攉蘊贊贈證盦霸飆鱉襯躍纏躑齣蠢巔黨鶯歡鰗護轟鑑顧灌響鶴權譴蠟欄蘭爛鐐鰱露籠礱籠襪鰻囊醹瓤齧鰲攝闢辯鷂懿櫻躍鬚襲續麝贖攤聽疊鐵讀彎鑊酇贓鷓顫犧靄齆挷變蠶糍籤竊鍫鑿溚癲鷹攪羈驚攪钁躩觀罐顯摢揢蝲攬纜籬驢鬣尞戀啉靈攣籮鑼鱸鑢蠻攬躪囓巖聶釅驗讓釀鱷戇誐贌鹽腅豔癰讎绹廳體糶鬱撍蘸鑽鱒";
total = chars.length;

var ns = "CharStep";

window[ns] = function(stepSize) {
  var r     = is_retina ? 2 : 1;

  this.size = 15;
  this.col  = Math.floor( window.innerWidth * r / this.size );
  this.row  = Math.ceil( total / this.col );
  this.prepare();
  this.init(stepSize);
};

window[ns].prototype = {
  prepare: function() {
    this.canvas = document.createElement('canvas');
    this.ctx    = this.canvas.getContext('2d');

    this.canvas.width  = this.col * this.size;
    this.canvas.height = this.row  * this.size;
  },

  init: function(stepSize) {
    this.setStepSize(stepSize);
    this.putText();
    this.getData();
    this.getAlphaData();
  },
  setStepSize:function(stepSize){
    if(!stepSize)
      stepSize = 15;
    this.stepSize = stepSize;
  },
  putText: function() {
    var word, x, y, i = total;
    var col = this.col, size = this.size;

    while( i-- ) {
      word = chars[i];
      x    = i % col * size;
      y    = Math.floor( i / col )*size + size;
      this.ctx.font  = "normal "+ size +"px sans-serif";
      this.ctx.fillText(word, x, y - 3);
    }
  },

  getData: function() {
    this.imageData  = this.ctx.getImageData( 0, 0, this.size * this.col , this.size * this.row );
    this._imageData = this.imageData.data;
  },

  getAlphaData: function() {
    this.alphaData = [];

    var start, alpha, point;
    var col = this.col, size = this.size;

    for( var i = 0 ; i < total ; i ++ ) {    
      alpha = 0;
      start = {
        x: i % col * size,
        y: Math.floor( i / col ) * size
      }

      for( var y = start.y ; y < start.y + size ; y ++ ) {
        for( var x = start.x ; x < start.x + size ; x ++ ) {
          point = (y * size * col + x);
          alpha += this._imageData.getAlpha(point * 4);
        }
      }

      this.alphaData.push( alpha / (size * size) );
    }
    this.alphaData = this.alphaData.map( 0, this.stepSize-1, true );
    this.outputNewChars();
    this.adjustOutputNewChars();
  },

  outputNewChars: function() {
    this.chars = new Array();
    for( var i = 0 ; i < this.stepSize ; i ++ ) this.chars[i] = "";
    for( var i = 0 ; i < total ; i ++ ) this.chars[ this.alphaData[i] ] += chars[i];
  },
  adjustOutputNewChars:function(){
    var length = this.chars.length;
    for(var i =0 ; i<length; i++){
      if(!this.chars[i]){
        for(var j=i+1;j<length;j++){
          if(this.chars[j]){
            var first = this.chars[j].substring(0,1);
            this.chars[i]=first;
            this.chars[j] = this.chars[j].substring(1);
            break;
          }
        }
      }
    }
  },

  getRandomWord: function( level ) {
    var string  = this.chars[ level ];

    if( ! string ) {
      return;
    };

    var length = string.length;
    var num    = Math.Random( 0, length - 1, true );
    return this.chars[ level ][num]
  },

};

})();